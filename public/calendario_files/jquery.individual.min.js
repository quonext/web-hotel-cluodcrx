!function($){var _elementos,_opciones,_entrada,_salida,_noches="#noches",_submit_button;$.fn.bc_motorform=function(opciones,args){if(_elementos=this,_entrada=$(_elementos).find(".entrada"),_salida=$(_elementos).find(".salida"),_submit_button=$(_elementos).find("button").eq(0),"string"==typeof opciones)return eval(opciones)(args);function init(){$(_entrada).find("input").attr("readonly","readonly"),$(_salida).find("input").attr("readonly","readonly"),fechas2txt(_entrada),fechas2txt(_salida),codpromo(),cambio_noches(),calendarios(),actualiza_noches()}function _get_fecha_actual_hotel(){var a=new Date,e=6e4*a.getTimezoneOffset();return new Date(a.getTime()+e+_opciones.offset_zona_horaria)}function fechas2txt(a){var e=str2date($(a).find("input").val()),t=_zero_delante(e.getDate()),n=_opciones.meses.split("@")[e.getMonth()]+" "+e.getFullYear();_opciones.class_fechas_txt?$(a).find("."+_opciones.class_fechas_txt).text(t+" "+n):($(a).find("span b, span strong").text(t),$(a).find("span i, span em").text(n))}function str2date(a){var e=a.split("/"),t=parseInt(e[0],10),n=parseInt(e[1],10),o=parseInt(e[2],10);return new Date(o,n-1,t)}function codpromo(){$(_elementos).find(".cprom a").click(function(){$(this).parent().fadeOut(100),$(this).parent().next().delay(300).fadeIn(200).find("input").focus()}),$(".cprom input").val()&&$(".cprom a").trigger("click")}function calendarios(){var a=$(_entrada).find("input"),e=$(_salida).find("input"),t=_get_fecha_actual_hotel(),n=_sumar_noches(new Date(t),1);$(a).datepicker({dateFormat:"dd/mm/yy",minDate:t,firstDay:1,showAnim:"slideDown",onSelect:function(t,n){t=t.split("/");var o=new Date(t[2],t[1]-1,t[0]),s=$(e).datepicker("getDate");if($(e).datepicker("option","minDate",_sumar_noches($(a).datepicker("getDate"),1)),o>=s){var i=_sumar_noches(o,1);$(e).val(_formatear_fecha(i)),fechas2txt(_entrada),fechas2txt(_salida)}else fechas2txt(_entrada);actualiza_noches(o,s)},onClose:function(){setTimeout(function(){$(e).datepicker("show")},0)}}),$(e).datepicker({dateFormat:"dd/mm/yy",firstDay:1,showAnim:"slideDown",onSelect:function(t,n){var o=$(a).datepicker("getDate");t=t.split("/");var s=new Date(t[2],t[1]-1,t[0]);if(s<=o){var i=_sumar_noches(o,1);$(e).datepicker("option","minDate",_formatear_fecha(i)),$(e).val(_formatear_fecha(i)),fechas2txt(_entrada),fechas2txt(_salida)}else fechas2txt(_salida);actualiza_noches(o,s),toggle_button()}}),$(e).datepicker("option","minDate",n);var o=_opciones.class_fechas_txt?"."+_opciones.class_fechas_txt:"span";$(_entrada).find(o).click(function(){$(a).datepicker("show")}),$(_salida).find(o).click(function(){$(e).datepicker("show")})}function actualiza_noches(a,e){var t=$(_entrada).find("input").datepicker("getDate").valueOf(),n=($(_salida).find("input").datepicker("getDate").valueOf()-t)/864e5;$(_noches).val(Math.round(n))}function cambio_noches(){$(_noches).change(function(){var a=parseInt($(this).val(),10);a<1&&(a=1);var e=_sumar_noches($(_entrada).find("input").datepicker("getDate"),a);$(_salida).find("input").val(_formatear_fecha(e)),fechas2txt(_salida),toggle_button()})}function toggle_button(){$(_submit_button).fadeOut(300).fadeIn(300).fadeOut(300).fadeIn(300)}function _sumar_noches(a,e){for(var t=1;e>=t&&t<365;)a.setTime(a.getTime()+864e5),1==a.getHours()?a.setTime(a.getTime()-36e5):23==a.getHours()&&a.setTime(a.getTime()+36e5),t++;return a}function _formatear_fecha(a){return _zero_delante(a.getDate())+"/"+_zero_delante(a.getMonth()+1)+"/"+a.getFullYear()}function _zero_delante(a){var e=new String(a);return 1==e.length?"0"+e:e}function buscar_en_fecha(a){var e=$(_entrada).find("input"),t=$(_salida).find("input"),n=$(_elementos).attr("action");a.cod_oferta&&(separador=n.indexOf("?")>-1?"&":"?",n+=separador+"co="+a.cod_oferta,a.codpromo&&(n+="&cp="+a.codpromo,$("#id_codpromo").val(a.codpromo))),$(_elementos).attr({action:n}),$(e).val(a.entrada),$(t).val(a.salida),$(_elementos).submit()}_opciones_default={class_fechas_txt:"",offset_zona_horaria:0-6e4*(new Date).getTimezoneOffset()},_opciones=jQuery.extend(_opciones_default,opciones),init()}}(jQuery),jQuery.fn.centrar=function(){$(window).height(),this.outerHeight(),$(window).scrollTop();var a=($(window).width()-this.outerWidth())/2+$(window).scrollLeft()+"px";return this.css("top","300px"),this.css("left",a),this},function($){var _elementos,_opciones,_fondo,_wnd_fechas,_entrada,_salida;$.fn.bc_ofertas=function(opciones,args){if(_elementos=this,"string"==typeof opciones)return eval(opciones)(args);function init(){$.map(_elementos,function(a){$(a).click(function(){fondo(),mostrar_ventan(a),calendarios(a)})})}function fondo(){_fondo=$("<div/>").attr("id",_opciones.id_fondo).css({opacity:_opciones.opacidad_fondo,height:$(document).height()}).appendTo("body").click(function(){$(this).remove(),$(_wnd_fechas).remove()})}function mostrar_ventan(a){_wnd_fechas=$("<div/>").attr("id",_opciones.id_fechas).appendTo("body").centrar(),$("<div/>").attr("class",_opciones.class_titulo).html($(a).data("oferta")).appendTo(_wnd_fechas),$("<div/>").attr("class",_opciones.class_cerrar).text("[X]").appendTo(_wnd_fechas).click(function(){$(_wnd_fechas).remove(),$(_fondo).remove()}),$("<span/>").attr("class",_opciones.class_entrada_txt).text(_opciones.entrada).appendTo(_wnd_fechas),$("<span/>").attr("class",_opciones.class_salida_txt).text(_opciones.salida).appendTo(_wnd_fechas),_entrada=$("<input/>").attr({class:_opciones.class_entrada_input,type:"text",readonly:"readonly"}).appendTo(_wnd_fechas),_salida=$("<input/>").attr({class:_opciones.class_salida_input,type:"text",readonly:"readonly"}).appendTo(_wnd_fechas),$("<button/>").attr("class",_opciones.class_button).text(_opciones.buscar).appendTo(_wnd_fechas).click(function(){var e=$(_entrada).val(),t=$(_salida).val(),n=$(a).data("codigo");if($(a).data("paquete")){var o=str2date(e),s=str2date(t),i=o.getFullYear()+"-"+("0"+(o.getMonth()+1)).slice(-2)+"-"+("0"+o.getDate()).slice(-2),c=s.getFullYear()+"-"+("0"+(s.getMonth()+1)).slice(-2)+"-"+("0"+s.getDate()).slice(-2),d=$(a).data("url")+"&fe="+i+"&fs="+c;window.location.replace(d)}else""!==e&&""!==t&&$("#"+_opciones.id_form).bc_motorform("buscar_en_fecha",{entrada:e,salida:t,cod_oferta:n})})}function calendarios(a){var e=$(a).data("minimo-noches");null!=e&&""!=e||(e=1);var t=$(a).data("lastminute"),n=$(a).data("desde");if(t)var o=n;else o=$(a).data("hasta");$(_wnd_fechas).find("."+_opciones.class_entrada_input).datepicker({dateFormat:"dd/mm/yy",firstDay:1,minDate:n,maxDate:o,onSelect:function(a,t){$(_wnd_fechas).find("."+_opciones.class_salida_input).datepicker("option","minDate",sumar_noches($(this).datepicker("getDate"),e))}}),$(_wnd_fechas).find("."+_opciones.class_salida_input).datepicker({dateFormat:"dd/mm/yy",firstDay:1,minDate:n,maxDate:$(a).data("hasta")});var s=str2date($(a).data("desde"));$(_wnd_fechas).find("."+_opciones.class_entrada_input).datepicker("setDate",s);var i=sumar_noches(str2date($(a).data("desde")),e);$(_wnd_fechas).find("."+_opciones.class_salida_input).datepicker("setDate",i)}function str2date(a){var e=a.split("/");return new Date(parseInt(e[2],10),parseInt(e[1],10)-1,parseInt(e[0],10))}function sumar_noches(a,e){for(var t=1;e>=t&&t<365;)a.setTime(a.getTime()+864e5),1==a.getHours()?a.setTime(a.getTime()-36e5):23==a.getHours()&&a.setTime(a.getTime()+36e5),t++;return a}_opciones_default={id_form:"bcmotor",opacidad_fondo:.8,id_fondo:"ofertafondo",id_fechas:"ofertafechas",class_titulo:"titulo",class_cerrar:"cerrar",class_entrada_txt:"entrada",class_salida_txt:"salida",class_entrada_input:"entrada_input",class_salida_input:"salida_input"},_opciones=jQuery.extend(_opciones_default,opciones),init()}}(jQuery),function($){var _elementos,_opciones,_fondo,_entrada,_salida,_modal_fechas;$.fn.bc_ofertas_modal=function(opciones,args){if(_elementos=this,"string"==typeof opciones)return eval(opciones)(args);var _opciones_default={id_modal:"modal_ofertafechas",id_form:"bcmotor",id_fechas:"ofertafechas",class_titulo:"titulo",class_entrada_txt:"Entrada",class_salida_txt:"Salida",class_entrada_input:"entrada_input",class_salida_input:"salida_input",class_codpromo_input:"input-codpromo-modal"};function init(){$.map(_elementos,function(a){$(a).click(function(e){e.preventDefault(),_modal_fechas.modal(),mostrar_ventan(a),calendarios(a)}),_modal_fechas.on("hidden.bs.modal",function(){$(_modal_fechas).find("."+_opciones.class_entrada_input).datepicker("destroy"),$(_modal_fechas).find("."+_opciones.class_salida_input).datepicker("destroy")})})}function mostrar_ventan(a){$(_modal_fechas).find("."+_opciones.class_titulo).text($(a).data("oferta")),$(_modal_fechas).find("button").not(".close").click(function(){var e=$("."+_opciones.class_entrada_input).val(),t=$("."+_opciones.class_salida_input).val(),n=$(a).data("codigo"),o=$(a).data("hotel-cod"),s=$(a).data("hotel"),i="",c=$("."+_opciones.class_codpromo_input);c&&(i=c.val()),""!==e&&""!==t&&$("#"+_opciones.id_form).bc_motorform("buscar_en_fecha",{entrada:e,salida:t,cod_oferta:n,cod_destino:o,desc_destino:s,codpromo:i})})}function calendarios(a){var e=$(a).data("minimo-noches");void 0!==e&&""!==e||(e=1);var t=$(a).data("lastminute"),n=$(a).data("desde"),o=str2date(n);o=sumar_noches(o,e);var s=$(a).data("hasta");t&&(s=n),$(_modal_fechas).find("."+_opciones.class_entrada_input).datepicker({dateFormat:"dd/mm/yy",firstDay:1,minDate:n,maxDate:s,onSelect:function(a,t){$(_modal_fechas).find("."+_opciones.class_salida_input).datepicker("option","minDate",sumar_noches($(this).datepicker("getDate"),e))},onClose:function(){setTimeout(function(){$(_modal_fechas).find("."+_opciones.class_salida_input).datepicker("show")},0)}}),$(_modal_fechas).find("."+_opciones.class_salida_input).datepicker({dateFormat:"dd/mm/yy",firstDay:1,minDate:n,maxDate:s});var i=str2date($(a).data("desde"));$(_modal_fechas).find("."+_opciones.class_entrada_input).datepicker("setDate",i);var c=sumar_noches(str2date($(a).data("desde")),e);$(_modal_fechas).find("."+_opciones.class_salida_input).datepicker("setDate",c)}function str2date(a){var e=a.split("/");return new Date(parseInt(e[2],10),parseInt(e[1],10)-1,parseInt(e[0],10))}function sumar_noches(a,e){for(var t=1;e>=t&&t<365;)a.setTime(a.getTime()+864e5),1==a.getHours()?a.setTime(a.getTime()-36e5):23==a.getHours()&&a.setTime(a.getTime()+36e5),t++;return a}_opciones=jQuery.extend(_opciones_default,opciones),_modal_fechas=$("body").find("#"+_opciones.id_modal),init()}}(jQuery);
